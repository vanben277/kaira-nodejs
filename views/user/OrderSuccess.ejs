<!DOCTYPE html>
<html lang="vi">

<head>
  <title>Đặt hàng thành công - Kaira</title>
  <%- include('../partials/user/Head') %>
  <style>
    .font-marcellus {
      font-family: "Marcellus", serif;
    }

    .success-icon-animation {
      animation: scaleIn 0.6s ease-out;
    }

    @keyframes scaleIn {
      0% {
        transform: scale(0);
        opacity: 0;
      }

      70% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
  </style>
</head>

<body class="bg-gray-50">
  <%- include('../partials/user/SVGIcon') %>
  <%- include('../partials/user/Search') %>
  <%- include('../partials/user/Header') %>

  <div class="container mx-auto px-4 py-16">
    <div class="max-w-4xl mx-auto">

      <div class="text-center mb-12">
        <% if (order.payment_method === 'bank_transfer' && order.payment_status !== 'paid') { %>
        <div class="inline-flex items-center justify-center w-24 h-24 bg-yellow-100 rounded-full mb-6 success-icon-animation">
          <svg class="w-12 h-12 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <h1 class="text-3xl md:text-4xl font-marcellus text-gray-900 mb-4">
          Đơn hàng đã được ghi nhận!
        </h1>
        <p class="text-xl text-yellow-700 font-medium mb-2">
          Vui lòng chuyển khoản để hoàn tất đơn hàng
        </p>
        <p class="text-gray-600 text-lg">
          Mã đơn hàng: <span class="font-bold text-gray-900">#<%= order.order_number %></span>
        </p>
        <% } else { %>
        <div class="inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-6 success-icon-animation">
          <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h1 class="text-3xl md:text-4xl font-marcellus text-gray-900 mb-4">
          Cảm ơn bạn đã đặt hàng!
        </h1>
        <p class="text-gray-600 text-lg">
          Mã đơn hàng của bạn là: <span class="font-bold text-gray-900">#<%= order.order_number %></span>
        </p>
        <% } %>
      </div>

      <!-- QR + HƯỚNG DẪN CHUYỂN KHOẢN -->
      <% if (order.payment_method === 'bank_transfer' && order.payment_status !== 'paid') { %>
      <div class="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-8 mb-10 text-center">
        <div class="max-w-md mx-auto">
          <h3 class="text-2xl font-marcellus text-yellow-900 mb-6">Thông tin chuyển khoản</h3>

          <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <p class="text-4xl font-bold text-red-600 mb-4">
              <%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(order.total) %>
            </p>
            <p class="text-lg font-medium text-gray-800 mb-3">
              Nội dung: <span class="font-mono bg-gray-100 px-3 py-1 rounded">DH <%= order.order_number %></span>
            </p>
            <div class="text-left space-y-1 text-sm">
              <p><strong>Ngân hàng:</strong> Techcombank</p>
              <p><strong>STK:</strong> 19038861761019</p>
              <p><strong>Chủ TK:</strong> KairaStore</p>
            </div>
          </div>

          <div class="bg-gray-50 p-6 rounded-lg">
            <img src="https://img.vietqr.io/image/970407-19038861761019-compact.png?amount=<%= order.total %>&addInfo=DH%20<%= order.order_number %>&accountName=KairaStore" alt="QR Techcombank" class="w-64 h-64 mx-auto border-4 border-white shadow-lg rounded-lg">
            <p class="text-xs text-gray-500 mt-4">
              Quét bằng app ngân hàng để chuyển tiền nhanh
            </p>
          </div>

          <div class="mt-6 p-4 bg-green-50 rounded-lg text-green-800">
            <p class="font-medium">
              Sau khi chuyển khoản, đơn hàng sẽ được cập nhật trong vòng 5-10 phút.
            </p>
          </div>
        </div>
      </div>
      <% } %>

      <!-- THÔNG TIN ĐƠN HÀNG -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

        <div class="bg-white rounded-lg shadow-sm p-6 md:p-8 border border-gray-100">
          <h2 class="text-xl font-marcellus text-gray-900 mb-6 border-b pb-4">Thông tin nhận hàng</h2>
          <div class="space-y-6">
            <div>
              <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-2">Người nhận</h3>
              <p class="text-gray-900 font-medium"><%= order.customer_info.full_name %></p>
              <p class="text-gray-600"><%= order.customer_info.phone %></p>
              <p class="text-gray-600"><%= order.customer_info.address %></p>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-2">Thanh toán</h3>
              <p class="text-gray-900 font-medium">
                <%= order.payment_method === 'bank_transfer' ? 'Chuyển khoản ngân hàng' : 'Thanh toán khi nhận hàng (COD)' %>
              </p>
              <p class="text-sm mt-2">
                Trạng thái:
                <% if(order.payment_status === 'paid') { %>
                <span class="text-green-600 font-bold text-lg">Đã thanh toán</span>
                <% } else if(order.payment_method === 'bank_transfer') { %>
                <span class="text-yellow-600 font-bold text-lg">Chờ chuyển khoản</span>
                <% } else { %>
                <span class="text-gray-600">Chưa thanh toán</span>
                <% } %>
              </p>
            </div>

            <% if(order.customer_info.note) { %>
            <div>
              <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-2">Ghi chú</h3>
              <p class="text-gray-600 italic">"<%= order.customer_info.note %>"</p>
            </div>
            <% } %>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6 md:p-8 border border-gray-100">
          <h2 class="text-xl font-marcellus text-gray-900 mb-6 border-b pb-4">Chi tiết đơn hàng</h2>
          <ul class="divide-y divide-gray-100 mb-6">
            <% order.items.forEach(item => { %>
            <li class="py-4 flex items-start">
              <div class="flex-shrink-0 w-16 h-16 border border-gray-200 rounded-md overflow-hidden">
                <img src="<%= item.product_image || '/images/default-product.jpg' %>" alt="<%= item.product_name %>" class="w-full h-full object-cover" onerror="this.src='/images/default-product.jpg'">
              </div>
              <div class="ml-4 flex-1">
                <h4 class="text-sm font-medium text-gray-900 line-clamp-2"><%= item.product_name %></h4>
                <% if (item.variant_color || item.size) { %>
                <p class="text-xs text-gray-500 mt-1">
                  <%= item.variant_color ? 'Màu: ' + item.variant_color : '' %>
                  <%= item.variant_color && item.size ? ' | ' : '' %>
                  <%= item.size ? 'Size: ' + item.size : '' %>
                </p>
                <% } %>
                <div class="flex justify-between items-center mt-2">
                  <p class="text-sm text-gray-500">x <%= item.quantity %></p>
                  <p class="text-sm font-medium text-gray-900">
                    <%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(item.total) %>
                  </p>
                </div>
              </div>
            </li>
            <% }); %>
          </ul>

          <div class="border-t pt-4 space-y-2">
            <div class="flex justify-between text-sm text-gray-600">
              <p>Tạm tính</p>
              <p><%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(order.subtotal) %></p>
            </div>
            <div class="flex justify-between text-sm text-gray-600">
              <p>Phí vận chuyển</p>
              <p><%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(order.shipping_fee) %></p>
            </div>
            <div class="flex justify-between text-base font-bold text-gray-900 pt-3 border-t mt-3">
              <p>Tổng cộng</p>
              <p class="text-2xl"><%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(order.total) %></p>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-12 text-center space-x-4">
        <a href="/" class="inline-block bg-gray-900 text-white px-8 py-3 rounded-md font-medium hover:bg-gray-800 transition uppercase text-sm tracking-wider">
          Tiếp tục mua sắm
        </a>
        <a href="/order-tracking/<%= order.order_number %>" class="inline-block bg-white text-gray-900 border-2 border-gray-900 px-8 py-3 rounded-md font-medium hover:bg-gray-50 transition uppercase text-sm tracking-wider">
          Theo dõi đơn hàng
        </a>
      </div>
    </div>
  </div>

  <%- include('../partials/user/Footer') %>
  <%- include('../partials/user/Script') %>

  <script>
    $(document).ready(function() {
      localStorage.removeItem("kaira_cart");
      if (typeof window.updateCartCount === "function") window.updateCartCount();
    });
  </script>
</body>

</html>