<!DOCTYPE html>
<html lang="vi">
  <head>
    <title>Đặt hàng thành công - Kaira</title>
    <%- include('../partials/user/Head') %>
    <style>
      .font-marcellus {
        font-family: "Marcellus", serif;
      }
      .success-icon-animation {
        animation: scaleIn 0.5s ease-in-out;
      }
      @keyframes scaleIn {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        60% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
    </style>
  </head>

  <body class="bg-gray-50">
    <%- include('../partials/user/SVGIcon') %> <%-
    include('../partials/user/Search') %> <%- include('../partials/user/Header')
    %>

    <div class="container mx-auto px-4 py-16">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
          <div
            class="inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-6 success-icon-animation"
          >
            <svg
              class="w-10 h-10 text-green-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              ></path>
            </svg>
          </div>
          <h1 class="text-3xl md:text-4xl font-marcellus text-gray-900 mb-4">
            Cảm ơn bạn đã đặt hàng!
          </h1>
          <p class="text-gray-600 text-lg">
            Mã đơn hàng của bạn là:
            <span class="font-bold text-gray-900"
              >#<%= order.order_number %></span
            >
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div
            class="bg-white rounded-lg shadow-sm p-6 md:p-8 border border-gray-100"
          >
            <h2 class="text-xl font-marcellus text-gray-900 mb-6 border-b pb-4">
              Thông tin nhận hàng
            </h2>

            <div class="space-y-6">
              <div>
                <h3
                  class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-2"
                >
                  Người nhận
                </h3>
                <p class="text-gray-900 font-medium">
                  <%= order.customer_info.full_name %>
                </p>
                <p class="text-gray-600"><%= order.customer_info.phone %></p>
                <p class="text-gray-600"><%= order.customer_info.address %></p>
              </div>

              <div>
                <h3
                  class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-2"
                >
                  Phương thức thanh toán
                </h3>
                <p class="text-gray-900 font-medium">
                  <% let paymentText = 'Thanh toán khi nhận hàng (COD)';
                  if(order.payment_method === 'bank_transfer') paymentText =
                  'Chuyển khoản ngân hàng'; else if(order.payment_method ===
                  'momo') paymentText = 'Ví MoMo'; else if(order.payment_method
                  === 'vnpay') paymentText = 'VNPay'; %> <%= paymentText %>
                </p>
                <p class="text-sm text-gray-500 mt-1">
                  Trạng thái: <% if(order.payment_status === 'paid') { %>
                  <span class="text-green-600 font-medium">Đã thanh toán</span>
                  <% } else { %>
                  <span class="text-yellow-600 font-medium"
                    >Chưa thanh toán</span
                  >
                  <% } %>
                </p>
              </div>

              <div>
                <h3
                  class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-2"
                >
                  Vận chuyển
                </h3>
                <p class="text-gray-900">Giao hàng tiêu chuẩn</p>
                <p class="text-gray-600 text-sm">
                  Dự kiến giao hàng: 3 - 5 ngày làm việc
                </p>
              </div>

              <% if(order.customer_info.note) { %>
              <div>
                <h3
                  class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-2"
                >
                  Ghi chú
                </h3>
                <p class="text-gray-600 italic">
                  "<%= order.customer_info.note %>"
                </p>
              </div>
              <% } %>
            </div>
          </div>

          <div
            class="bg-white rounded-lg shadow-sm p-6 md:p-8 border border-gray-100"
          >
            <h2 class="text-xl font-marcellus text-gray-900 mb-6 border-b pb-4">
              Chi tiết đơn hàng
            </h2>

            <ul class="divide-y divide-gray-100 mb-6">
              <% order.items.forEach(item => { %>
              <li class="py-4 flex items-start">
                <div
                  class="flex-shrink-0 w-16 h-16 border border-gray-200 rounded-md overflow-hidden"
                >
                  <img
                    src="<%= item.product_image || '/images/default-product.jpg' %>"
                    alt="<%= item.product_name %>"
                    class="w-full h-full object-cover"
                    onerror="this.src='/images/default-product.jpg'"
                  />
                </div>
                <div class="ml-4 flex-1">
                  <h4 class="text-sm font-medium text-gray-900 line-clamp-2">
                    <%= item.product_name %>
                  </h4>

                  <% if (item.size || item.variant_color) { %>
                  <p class="text-xs text-gray-500 mt-1">
                    <%= item.size ? `Size: ${item.size}` : '' %> <%= (item.size
                    && item.variant_color) ? '|' : '' %> <%= item.variant_color
                    ? `Màu: ${item.variant_color}` : '' %>
                  </p>
                  <% } %>

                  <div class="flex justify-between items-center mt-2">
                    <p class="text-sm text-gray-500">x <%= item.quantity %></p>
                    <p class="text-sm font-medium text-gray-900">
                      <%= new Intl.NumberFormat('vi-VN', { style: 'currency',
                      currency: 'VND' }).format(item.total) %>
                    </p>
                  </div>
                </div>
              </li>
              <% }); %>
            </ul>

            <div class="border-t border-gray-100 pt-4 space-y-2">
              <div class="flex justify-between text-sm text-gray-600">
                <p>Tạm tính</p>
                <p>
                  <%= new Intl.NumberFormat('vi-VN', { style: 'currency',
                  currency: 'VND' }).format(order.subtotal) %>
                </p>
              </div>
              <div class="flex justify-between text-sm text-gray-600">
                <p>Phí vận chuyển</p>
                <p>
                  <%= new Intl.NumberFormat('vi-VN', { style: 'currency',
                  currency: 'VND' }).format(order.shipping_fee) %>
                </p>
              </div>
              <% if(order.discount > 0) { %>
              <div class="flex justify-between text-sm text-green-600">
                <p>Giảm giá</p>
                <p>
                  - <%= new Intl.NumberFormat('vi-VN', { style: 'currency',
                  currency: 'VND' }).format(order.discount) %>
                </p>
              </div>
              <% } %>
              <div
                class="flex justify-between text-base font-bold text-gray-900 pt-2 border-t border-gray-100 mt-2"
              >
                <p>Tổng cộng</p>
                <p class="text-xl">
                  <%= new Intl.NumberFormat('vi-VN', { style: 'currency',
                  currency: 'VND' }).format(order.total) %>
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-12 text-center space-x-4">
          <a
            href="/"
            class="inline-block bg-gray-900 text-white px-8 py-3 rounded-md font-medium hover:bg-gray-800 transition duration-300 uppercase text-sm tracking-wider"
          >
            Tiếp tục mua sắm
          </a>
          <!-- Nếu có trang theo dõi đơn hàng -->
          <!-- <a href="/order-tracking/<%= order.order_number %>" class="inline-block bg-white text-gray-900 border border-gray-300 px-8 py-3 rounded-md font-medium hover:bg-gray-50 transition duration-300 uppercase text-sm tracking-wider">
            Theo dõi đơn hàng
          </a> -->
        </div>
      </div>
    </div>

    <%- include('../partials/user/Footer') %> <%-
    include('../partials/user/Script') %>

    <script>
      $(document).ready(function () {
        localStorage.removeItem("kaira_cart");
        if (typeof window.updateCartCount === "function") {
          window.updateCartCount();
        }
      });
    </script>
  </body>
</html>
